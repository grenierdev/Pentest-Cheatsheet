# Pentest Cheatsheet



## Host discovery

### Remote

```sh
# NMAP
sudo nmap 10.5.5.0/24 -PE -sn

# Bash
for i in {1..255}; do ping -c 1 -W 1 10.5.5.$i | grep '64 bytes' | cut -d" " -f 4 | tr -d ":"; done

# CMD
for /L %i IN (1,1,255) do @ping -n 1 -w 1000 10.5.5.%i > null && echo 10.5.5.%i is up.

# DNS (Host)
for i in {1..255}; do host 10.5.5.$i SERVER; done | grep -v "not found"

# DNS (Dig)
for i in {1..255}; do dig +timeout=1 +noall +answer -x 10.5.5.$i @SERVER; done
```


### Local
		
```sh
# Docker
docker ps -a

# Hyper-V
Get-VM
```


## Port discovery

### Remote

```sh
# NMAP
nmap 10.5.5.5 -p- -n -Pn -sS -T3 --reason --open

# Netcat (TCP)
nc -n -z -v -w 1 10.5.5.5 1-65535 2>&1 | grep open

# Netcat (UDP)
nc -u -n -z -v -w 1 10.5.5.5 1-65535 2>&1 | grep open

# Powershell (TCP)
$ip = "10.5.5.5"; foreach ($i in (1..65535)) { $s = New-Object System.Net.Sockets.TcpClient; try { $c = $s.ConnectAsync($ip, $i); for ($t = 10; --$t -gt 0;) { if ($c.isCompleted) { break; } Start-Sleep -milliseconds 100; } if ($s.Connected) { Write-Host "$i is open" } } finally { $s.Dispose() } }
```

### Local

```sh
# NMAP
nmap 127.0.0.1 -p- -n -Pn -sT -T3 --reason --open

# Netstat (Linux)
netstat -natup

# Netstat (Windows)
netstat -ano

# Manually (Linux)
awk 'function hextodec(str,ret,n,i,k,c){ret = 0;n = length(str);for (i = 1; i <= n; i++) {c = tolower(substr(str, i, 1));k = index("123456789abcdef", c);ret = ret * 16 + k;}return ret;}function getIP(str,ret){ret=hextodec(substr(str,index(str,":")-2,2));for (i=5; i>0; i-=2) {ret = ret"."hextodec(substr(str,i,2));}    ret = ret":"hextodec(substr(str,index(str,":")+1,4));return ret;} NR > 1 {{if(NR==2)print "Local - Remote";local=getIP($2);remote=getIP($3)}{print local" - "remote}}' /proc/net/tcp

# Manually (Windows)
$ip = "127.0.0.1"; foreach ($i in (1..65535)) { $s = New-Object System.Net.Sockets.TcpClient; try { $c = $s.ConnectAsync($ip, $i); for ($t = 10; --$t -gt 0;) { if ($c.isCompleted) { break; } Start-Sleep -milliseconds 100; } if ($s.Connected) { Write-Host "$i is open" } } finally { $s.Dispose() } }
```

## Service Discovery

### Remote

```sh
# NMAP
nmap 10.5.5.5 -p 80,443,3306 -n -Pn -sT -sV -T3 --reason --open

# Netcat banners (LF line ending)
nc -nv 10.5.5.5 80

# Netcat CRLF line ending
nc -nvc 10.5.5.5 80
```

### Local

```sh
# NMAP
nmap 127.0.0.1 -p 80,443,3306 -n -Pn -sT -sV -T3 --reason --open

# Netcat banners (LF line ending)
nc -nv 127.0.0.1 80

# Netcat CRLF line ending
nc -nvc 127.0.0.1 80

# Services (Linux)
systemctl list-units --type=service

# Services (Windows)
tasklist /SVC
wmic service get name,displayname,startmode,pathname
```

## vHost Discovery

### Remote
```sh
# Firstly you need the response length of a false positive
curl -s -H 'Host: nonexistent.ledomain.local' http://10.5.5.5 | wc -c

# Secondly, you need the status code of a false positive
curl -s -o /dev/null -w "%{http_code}" -H 'Host: nonexistent.ledomain.local' http://10.5.5.5

# FFuF (`-fs` and `-fc` to exclude false positive)
ffuf -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt -u http://10.5.5.5/ -H 'Host: FUZZ.ledomain.local' -fs 11952 -fc 200 -mc all
```

### Local
```sh
# List Apache config
cat /etc/apache2/conf.d/*
cat /etc/apache2/sites-enabled/*

# List Nginx vhost
cat /etc/nginx/sites-enabled/*
nginx -T

# List IIS vhost
Get-IISSite
```

## Process Discovery

### Local
```sh
# Processes (Linux)
ps aux --forest

# Processes (Windows)
tasklist
wmic process
Get-Process
```