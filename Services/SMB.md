# SMB

Ports: `137 (UDP), 138 (UDP), 139 (TCP), 445 (TCP)`

## SMB Client

```sh
# List share anonymously
smbclient -U '%' -L //10.10.11.152
# List share without any creds
smbclient -N -L //10.10.11.152
```

## NMAP scan
```sh
┌──(grenierdev㉿kali)-[~]
└─$ sudo nmap -n -sS -T3 --reason 10.11.1.0/24 -p137,138,139,445 --open -oG - | grep "Ports: " | awk '{print $2}' | tee smbhostsvulns

# NMAP scripts
┌──(grenierdev㉿kali)-[~]
└─$ for s in $(locate .nse | grep "smb"); do echo -n $s "\t" && echo $(cat $s | grep -oh -P -z "(?Us)description\s*=\s*\[\[\s*\K.*\]\]" | tr -d '\n' | head -c 100); done
/usr/share/nmap/scripts/smb-brute.nse   Attempts to guess username/password combinations over SMB, storing discovered combinationsfor use in
/usr/share/nmap/scripts/smb-double-pulsar-backdoor.nse  Checks if the target machine is running the Double Pulsar SMB backdoor.Based on the python detection
/usr/share/nmap/scripts/smb-enum-domains.nse    Attempts to enumerate domains on a system, along with their policies. This generally requirescredent
/usr/share/nmap/scripts/smb-enum-groups.nse     Obtains a list of groups from the remote Windows system, as well as a list of the group's users.This
/usr/share/nmap/scripts/smb-enum-processes.nse  Pulls a list of processes from the remote server over SMB. This will determineall running processes,
/usr/share/nmap/scripts/smb-enum-services.nse   Retrieves the list of services running on a remote Windows system.Each service attribute contains se
/usr/share/nmap/scripts/smb-enum-sessions.nse   Enumerates the users logged into a system either locally or through an SMB share. The local userscan
/usr/share/nmap/scripts/smb-enum-shares.nse     Attempts to list shares using the <code>srvsvc.NetShareEnumAll</code> MSRPC function andretrieve mor
/usr/share/nmap/scripts/smb-enum-users.nse      Attempts to enumerate the users on a remote Windows system, with as muchinformation as possible, thr
/usr/share/nmap/scripts/smb-flood.nse   Exhausts a remote SMB server's connection limit by by opening as manyconnections as we can. Most im
/usr/share/nmap/scripts/smb-ls.nse      Attempts to retrieve useful information about files shared on SMB volumes.The output is intended to
/usr/share/nmap/scripts/smb-mbenum.nse  Queries information managed by the Windows Master Browser.]] 
/usr/share/nmap/scripts/smb-os-discovery.nse    Attempts to determine the operating system, computer name, domain, workgroup, and currenttime over t
/usr/share/nmap/scripts/smb-print-text.nse      Attempts to print text on a shared printer by calling Print Spooler Service RPC functions.In order t
/usr/share/nmap/scripts/smb-protocols.nse       Attempts to list the supported protocols and dialects of a SMB server.The script attempts to initiat
/usr/share/nmap/scripts/smb-psexec.nse  Implements remote process execution similar to the Sysinternals' psexectool, allowing a user to run
/usr/share/nmap/scripts/smb-security-mode.nse   Returns information about the SMB security level determined by SMB.Here is how to interpret the outp
/usr/share/nmap/scripts/smb-server-stats.nse    Attempts to grab the server's statistics over SMB and MSRPC, which uses TCPports 445 or 139.An admin
/usr/share/nmap/scripts/smb-system-info.nse     Pulls back information about the remote system from the registry. Getting allof the information requ
/usr/share/nmap/scripts/smb-vuln-conficker.nse  Detects Microsoft Windows systems infected by the Conficker worm. This check is dangerous andit may
/usr/share/nmap/scripts/smb-vuln-cve-2017-7494.nse      Checks if target machines are vulnerable to the arbitrary shared library loadvulnerability CVE-2017-
/usr/share/nmap/scripts/smb-vuln-cve2009-3103.nse       Detects Microsoft Windows systems vulnerable to denial of service (CVE-2009-3103).This script will c
/usr/share/nmap/scripts/smb-vuln-ms06-025.nse   Detects Microsoft Windows systems with Ras RPC service vulnerable to MS06-025.MS06-025 targets the <
/usr/share/nmap/scripts/smb-vuln-ms07-029.nse   Detects Microsoft Windows systems with Dns Server RPC vulnerable to MS07-029.MS07-029 targets the <c
/usr/share/nmap/scripts/smb-vuln-ms08-067.nse   Detects Microsoft Windows systems vulnerable to the remote code execution vulnerabilityknown as MS08
/usr/share/nmap/scripts/smb-vuln-ms10-054.nse   Tests whether target machines are vulnerable to the ms10-054 SMB remote memorycorruption vulnerabili
/usr/share/nmap/scripts/smb-vuln-ms10-061.nse   Tests whether target machines are vulnerable to ms10-061 Printer Spooler impersonation vulnerability
/usr/share/nmap/scripts/smb-vuln-ms17-010.nse   Attempts to detect if a Microsoft SMBv1 server is vulnerable to a remote code execution vulnerabilit
/usr/share/nmap/scripts/smb-vuln-regsvc-dos.nse         Checks if a Microsoft Windows 2000 system is vulnerable to a crash in regsvc caused by a null pointe
/usr/share/nmap/scripts/smb-vuln-webexec.nse    Checks whether the WebExService is installed and allows us to run code.Note: Requires a user account
/usr/share/nmap/scripts/smb-webexec-exploit.nse         Attempts to run a command via WebExService, using the WebExec vulnerability.Given a Windows account
/usr/share/nmap/scripts/smb2-capabilities.nse   Attempts to list the supported capabilities in a SMBv2 server for each enabled dialect.The script se
/usr/share/nmap/scripts/smb2-security-mode.nse  Determines the message signing configuration in SMBv2 servers for all supported dialects.The script
/usr/share/nmap/scripts/smb2-time.nse   Attempts to obtain the current system date and the start date of a SMB2 server.]] 
/usr/share/nmap/scripts/smb2-vuln-uptime.nse    Attempts to detect missing patches in Windows systems by checking theuptime returned during the SMB
```

## nbtscan
```sh
┌──(grenierdev㉿kali)-[~]
└─$ nbtscan -v -r 10.11.1.0/24 | tee smbhostsvulns2
```

## enum4linux scan
[See enum4linux](./enum4linux.md)