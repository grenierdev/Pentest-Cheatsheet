# DNS

Port: `53 (UDP, TCP)`

## NMAP scan
```sh
┌──(grenierdev㉿kali)-[~]
└─$ sudo nmap -n -sS -T3 --reason 10.11.1.0/24 -p53 --open -oG - | grep "Ports: " | awk '{print $2}' | tee dnshosts
```


## Examples

```sh
# Retrieve name servers
┌──(grenierdev㉿kali)-[~]
└─$ host -t ns megacorpone.com 
megacorpone.com name server ns1.megacorpone.com.
megacorpone.com name server ns3.megacorpone.com.
megacorpone.com name server ns2.megacorpone.com.

┌──(grenierdev㉿kali)-[~]
└─$ dig -t NS +noall +answer megacorpone.com
megacorpone.com.        5       IN      NS      ns3.megacorpone.com.
megacorpone.com.        5       IN      NS      ns1.megacorpone.com.
megacorpone.com.        5       IN      NS      ns2.megacorpone.com.

# Retrieve TXT records only
┌──(grenierdev㉿kali)-[~]
└─$ host -t txt megacorpone.com
megacorpone.com descriptive text "Try Harder"
megacorpone.com descriptive text "google-site-verification=U7B_b0HNeBtY4qYGQZNsEYXfCJ32hMNV3GtC0wWq5pA"
                                                                                  
┌──(grenierdev㉿kali)-[~]
└─$ dig -t TXT +noall +answer megacorpone.com
megacorpone.com.        5       IN      TXT     "Try Harder"
megacorpone.com.        5       IN      TXT     "google-site-verification=U7B_b0HNeBtY4qYGQZNsEYXfCJ32hMNV3GtC0wWq5pA"

# Specific name server
┌──(grenierdev㉿kali)-[~]
└─$ dig -t TXT +noall +answer megacorpone.com @ns1.megacorpone.com
megacorpone.com.        300     IN      TXT     "google-site-verification=U7B_b0HNeBtY4qYGQZNsEYXfCJ32hMNV3GtC0wWq5pA"
megacorpone.com.        300     IN      TXT     "Try Harder"
```

## Forward brute force

_Using [SecLists](../Resources/SecLists.md)_

```sh
┌──(grenierdev㉿kali)-[~]
└─$ for sub in $(cat /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt); do host $sub.megacorpone.com; done
www.megacorpone.com has address 149.56.244.87
mail.megacorpone.com has address 51.222.169.212
Host ftp.megacorpone.com not found: 3(NXDOMAIN)
Host localhost.megacorpone.com not found: 3(NXDOMAIN)
Host webmail.megacorpone.com not found: 3(NXDOMAIN)
Host smtp.megacorpone.com not found: 3(NXDOMAIN)
Host webdisk.megacorpone.com not found: 3(NXDOMAIN)
Host pop.megacorpone.com not found: 3(NXDOMAIN)
Host cpanel.megacorpone.com not found: 3(NXDOMAIN)
Host whm.megacorpone.com not found: 3(NXDOMAIN)
...
```

## Reverse brute force

> Our DNS forward brute force enumeration revealed a set of scattered IP addresses in the same approximate range (38.100.193.X). If the DNS administrator of megacorpone.com configured [PTR](https://en.wikipedia.org/wiki/Reverse_DNS_lookup) records for the domain, we could scan the approximate range with reverse lookups to request the hostname for each IP.

```sh
┌──(grenierdev㉿kali)-[~]
└─$ for ip in $(seq 50 100); do host 38.100.193.$ip; done | grep -v "not found"
66.193.100.38.in-addr.arpa domain name pointer syslog.megacorpone.com.
69.193.100.38.in-addr.arpa domain name pointer beta.megacorpone.com.
70.193.100.38.in-addr.arpa domain name pointer ns1.megacorpone.com.
72.193.100.38.in-addr.arpa domain name pointer admin.megacorpone.com.
73.193.100.38.in-addr.arpa domain name pointer mail2.megacorpone.com.
76.193.100.38.in-addr.arpa domain name pointer www.megacorpone.com.
77.193.100.38.in-addr.arpa domain name pointer vpn.megacorpone.com.
80.193.100.38.in-addr.arpa domain name pointer ns2.megacorpone.com.
84.193.100.38.in-addr.arpa domain name pointer mail.megacorpone.com.
85.193.100.38.in-addr.arpa domain name pointer snmp.megacorpone.com.
89.193.100.38.in-addr.arpa domain name pointer siem.megacorpone.com.
90.193.100.38.in-addr.arpa domain name pointer ns3.megacorpone.com.
91.193.100.38.in-addr.arpa domain name pointer router.megacorpone.com.

┌──(grenierdev㉿kali)-[~/Documents/OSCP-EXAM-REPORT]
└─$ for ip in $(seq 1 255); do dig +timeout=1 +noall +answer -x 192.168.136.$ip @192.168.136.149; done
124.136.168.192.in-addr.arpa. 3600 IN   PTR     OS{db9c2362613a8da339bed4be5d17269b}.
149.136.168.192.in-addr.arpa. 3600 IN   PTR     dc.MAILMAN.com.
```

## DNS zone transfert (bash)
```sh
┌──(grenierdev㉿kali)-[~]
└─$ for ns in $(dig -t NS +noall +answer megacorpone.com | awk -F' ' '{print substr($5, 0, length($5)-1)}'); do host -l megacorpone.com $ns | grep "has address"; done
admin.megacorpone.com has address 51.222.169.208
beta.megacorpone.com has address 51.222.169.209
fs1.megacorpone.com has address 51.222.169.210
intranet.megacorpone.com has address 51.222.169.211
mail.megacorpone.com has address 51.222.169.212
mail2.megacorpone.com has address 51.222.169.213
ns1.megacorpone.com has address 51.79.37.18
ns2.megacorpone.com has address 51.222.39.63
ns3.megacorpone.com has address 66.70.207.180
router.megacorpone.com has address 51.222.169.214
siem.megacorpone.com has address 51.222.169.215
snmp.megacorpone.com has address 51.222.169.216
support.megacorpone.com has address 51.222.169.218
syslog.megacorpone.com has address 51.222.169.217
test.megacorpone.com has address 51.222.169.219
vpn.megacorpone.com has address 51.222.169.220
www.megacorpone.com has address 149.56.244.87
www2.megacorpone.com has address 149.56.244.87
```

## DNS zone transfert (dnsrecon)
```sh
┌──(grenierdev㉿kali)-[~]
└─$ dnsrecon -d megacorpone.com -t axfr
[*] Checking for Zone Transfer for megacorpone.com name servers
[*] Resolving SOA Record
[+]      SOA ns1.megacorpone.com 51.79.37.18
[*] Resolving NS Records
[*] NS Servers found:
[+]      NS ns2.megacorpone.com 51.222.39.63
[+]      NS ns1.megacorpone.com 51.79.37.18
[+]      NS ns3.megacorpone.com 66.70.207.180
[*] Removing any duplicate NS server IP Addresses...
[*]  
[*] Trying NS server 66.70.207.180
[+] 66.70.207.180 Has port 53 TCP Open
[-] Zone Transfer Failed (Zone transfer error: REFUSED)
[*]  
[*] Trying NS server 51.222.39.63
[+] 51.222.39.63 Has port 53 TCP Open
[+] Zone Transfer was successful!!
[*]      NS ns1.megacorpone.com 51.79.37.18
[*]      NS ns2.megacorpone.com 51.222.39.63
[*]      NS ns3.megacorpone.com 66.70.207.180
[*]      TXT Try Harder
[*]      TXT google-site-verification=U7B_b0HNeBtY4qYGQZNsEYXfCJ32hMNV3GtC0wWq5pA
[*]      MX @.megacorpone.com fb.mail.gandi.net 217.70.178.215
[*]      MX @.megacorpone.com fb.mail.gandi.net 217.70.178.216
[*]      MX @.megacorpone.com fb.mail.gandi.net 217.70.178.217
[*]      MX @.megacorpone.com spool.mail.gandi.net 217.70.178.1
[*]      A admin.megacorpone.com 51.222.169.208
[*]      A beta.megacorpone.com 51.222.169.209
[*]      A fs1.megacorpone.com 51.222.169.210
[*]      A intranet.megacorpone.com 51.222.169.211
[*]      A mail.megacorpone.com 51.222.169.212
[*]      A mail2.megacorpone.com 51.222.169.213
[*]      A ns1.megacorpone.com 51.79.37.18
[*]      A ns2.megacorpone.com 51.222.39.63
[*]      A ns3.megacorpone.com 66.70.207.180
[*]      A router.megacorpone.com 51.222.169.214
[*]      A siem.megacorpone.com 51.222.169.215
[*]      A snmp.megacorpone.com 51.222.169.216
[*]      A support.megacorpone.com 51.222.169.218
[*]      A syslog.megacorpone.com 51.222.169.217
[*]      A test.megacorpone.com 51.222.169.219
[*]      A vpn.megacorpone.com 51.222.169.220
[*]      A www.megacorpone.com 149.56.244.87
[*]      A www2.megacorpone.com 149.56.244.87
[*]  
[*] Trying NS server 51.79.37.18
[+] 51.79.37.18 Has port 53 TCP Open
[-] Zone Transfer Failed (Zone transfer error: REFUSED)
```